(function(){var a=Object.prototype.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype;return b},c=function(a,b){return function(){return a.apply(b,arguments)}};window.Rdio={Models:{},Collections:{},Views:{},user:{},config:{}},$("#loader").ajaxStop(function(){return $(this).fadeOut()}).ajaxStart(function(){return $(this).fadeIn()}),Rdio.Views.app=function(){function a(){a.__super__.constructor.apply(this,arguments)}b(a,Backbone.View),a.prototype.el=$("body"),a.prototype.initialize=function(){Rdio.user.artists=new Rdio.Collections.Artists;return Rdio.user.playlists=new Rdio.Collections.Playlists};return a}(),Rdio.Routes=function(){function a(){a.__super__.constructor.apply(this,arguments)}b(a,Backbone.Router),a.prototype.routes={"artist/:name":"getArtist"},a.prototype.getArtist=function(a){var b;b=Rdio.user.artists.find(function(b){if(b.get("url")==="/artist/"+a+"/")return!0}),$("#"+b.get("artistKey")).trigger("click")};return a}(),$(function(){new Rdio.Views.app,Rdio.router=new Rdio.Routes,Backbone.history.start({pushState:!0});if(location.pathname.length>1)return Rdio.router.navigate(location.pathname,!0)}),Rdio.Collections.ArtistAlbums=function(){function a(){a.__super__.constructor.apply(this,arguments)}b(a,Backbone.Collection),a.prototype.initialize=function(a,b){this.model=Rdio.Models.Album;return this.view=new Rdio.Views.ArtistAlbums(this,b)};return a}(),Rdio.Models.Album=function(){function a(){a.__super__.constructor.apply(this,arguments)}b(a,Backbone.Model),a.prototype.initialize=function(a){return this.set({id:a.albumKey})};return a}(),Rdio.Collections.Artists=function(){function a(){a.__super__.constructor.apply(this,arguments)}b(a,Backbone.Collection),a.prototype.url="/api/getArtistsInCollection",a.prototype.initialize=function(){var a;this.model=Rdio.Models.Artist,a=qlc("artists");if(a!=null)this.reset(a),this.view=new Rdio.Views.Artists(this);else return this.fetch().success(c(function(a){qlc("artists",a,!1,!0);return this.view=new Rdio.Views.Artists(this)},this))};return a}(),Rdio.Models.Artist=function(){function a(){this.getAlbums=c(this.getAlbums,this),a.__super__.constructor.apply(this,arguments)}b(a,Backbone.Model),a.prototype.initialize=function(a){return this.set({id:this.cid})},a.prototype.getAlbums=function(a){return this.ablums!=null?this.albums.view.render():$.get("/api/getAlbumsForArtistInCollection?artist="+this.get("key"),c(function(b){return this.albums=new Rdio.Collections.ArtistAlbums(b,a)},this))};return a}(),Rdio.Collections.Playlists=function(){function a(){a.__super__.constructor.apply(this,arguments)}b(a,Backbone.Collection),a.prototype.url="/api/getPlaylists?extras=trackKeys",a.prototype.initialize=function(){this.model=Rdio.Models.Playlist,this.view=new Rdio.Views.Playlists;return $.get(this.url).success(c(function(a){return this.add(a.owned)},this))};return a}(),Rdio.Models.Playlist=function(){function a(){this.getTracks=c(this.getTracks,this),a.__super__.constructor.apply(this,arguments)}b(a,Backbone.Model),a.prototype.initialize=function(){return this.view=new Rdio.Views.Playlist(this)},a.prototype.getTracks=function(a){this.tracks=new Rdio.Collections.Tracks(null,this.get("trackKeys"));return this.tracks.fetch(a)};return a}(),Rdio.Models.NewPlaylist=function(){function a(){a.__super__.constructor.apply(this,arguments)}b(a,Backbone.Model),a.prototype.initialize=function(a){this.tracks=new Rdio.Collections.Tracks,this.view=Rdio.editPlaylist,this.view.render();return this.tracks.bind("add",c(function(){return this.view.render({tracks:this.tracks.toJSON()})},this))};return a}(),Rdio.Models.Track=function(){function a(){a.__super__.constructor.apply(this,arguments)}b(a,Backbone.Model);return a}(),Rdio.Collections.Tracks=function(){function a(){this.addTrack=c(this.addTrack,this),this.fetch=c(this.fetch,this),a.__super__.constructor.apply(this,arguments)}b(a,Backbone.Collection),a.prototype.url=function(){return"/api/get?keys="+this.keys.join(",")},a.prototype.initialize=function(a,b){b!=null&&(this.keys=b);return this.model=Rdio.Models.Track},a.prototype.fetch=function(a){return $.get(this.url(),c(function(b){this.add(_(b).values());if(_.isFunction(a))return a()},this))},a.prototype.addTrack=function(a){return $.get("/api/get?keys="+a,c(function(a){return this.add(_(a).values())},this))};return a}(),Rdio.Views.ArtistAlbums=function(){function a(){this.addToPlaylist=c(this.addToPlaylist,this),this.openAlbum=c(this.openAlbum,this),this.render=c(this.render,this),a.__super__.constructor.apply(this,arguments)}b(a,Backbone.View),a.prototype.className="tree-2",a.prototype.initialize=function(a,b){this.collection=a,this.parent=b;return this.render()},a.prototype.render=function(){var a;if(!(this.parent.find(".tree-2").length>1)){a=JST.albums({albums:this.collection.toJSON()});return $(this.el).html(a).appendTo(this.parent)}},a.prototype.events={"click .album":"openAlbum","click .add-to-playlist":"addToPlaylist"},a.prototype.openAlbum=function(){return!1},a.prototype.addToPlaylist=function(a){var b;b=$(a.target),Rdio.current_playlist!=null&&Rdio.current_playlist.tracks.addTrack(b.data("track"));return!1};return a}(),Rdio.Views.Artists=function(){function a(){this.loadArtistAlbums=c(this.loadArtistAlbums,this),this.render=c(this.render,this),a.__super__.constructor.apply(this,arguments)}b(a,Backbone.View),a.prototype.el=$("#artists-page"),a.prototype.initialize=function(a){this.collection=a,this.render();return this.text_filter=this.$("#filter-artists").quicksearch("#artists-page .tree li")},a.prototype.render=function(){return this.el.html(JST.artist({artists:this.collection.toJSON()}))},a.prototype.events={"click .artist":"loadArtistAlbums"},a.prototype.loadArtistAlbums=function(a){var b,c,d;a.preventDefault(),c=$(a.target),b=c.parent().toggleClass("active");if(b.find(".tree-2").length>0)b.find(".tree-2").slideToggle();else{d=this.collection.getByCid(c.data("cid"));return d.getAlbums(c.parent())}};return a}(),Rdio.Views.Playlists=function(){function a(){this.newPlaylist=c(this.newPlaylist,this),a.__super__.constructor.apply(this,arguments)}b(a,Backbone.View),a.prototype.el=$("#playlist-page"),a.prototype.initialize=function(){return Rdio.editPlaylist=new Rdio.Views.EditPlaylist},a.prototype.events={"click .new":"newPlaylist"},a.prototype.newPlaylist=function(){Rdio.current_playlist=new Rdio.Models.NewPlaylist;return!1};return a}(),Rdio.Views.Playlist=function(){function a(){this.edit=c(this.edit,this),a.__super__.constructor.apply(this,arguments)}b(a,Backbone.View),a.prototype.tagName="li",a.prototype.initialize=function(a){this.model=a;return this.render()},a.prototype.render=function(){return $(this.el).html(JST.playlist(this.model.toJSON())).appendTo("#playlists")},a.prototype.events={"click a":"edit"},a.prototype.edit=function(){Rdio.current_playlist=this.model,this.model.getTracks(c(function(){return Rdio.editPlaylist.render({playlist:this.model.toJSON(),tracks:this.model.tracks.toJSON()})},this));return!1};return a}(),Rdio.Views.EditPlaylist=function(){function a(){this.savePlaylist=c(this.savePlaylist,this),this.close=c(this.close,this),this.render=c(this.render,this),a.__super__.constructor.apply(this,arguments)}b(a,Backbone.View),a.prototype.el=$(".edit-playlist"),a.prototype.render=function(a){return this.el.html(JST.playlist_edit(a)).addClass("active")},a.prototype.events={"click button":"close",'click input[type="submit"]':"savePlaylist"},a.prototype.close=function(){this.el.removeClass("active");return!1},a.prototype.savePlaylist=function(){var a,b,d;d=Rdio.current_playlist.tracks.map(function(a){return a.get("key")}),b=this.el.find("#playlist-name"),a=this.el.find("#playlist-desc"),$.get("/api/createPlaylist?name="+b.val()+"&description="+a.val()+"&tracks="+d.join(","),c(function(a){$("#playlist-page ul").remove();return Rdio.user.playlists=new Rdio.Collections.Playlists},this));return!1};return a}()}).call(this)